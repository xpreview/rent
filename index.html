<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monthly Room Rental Register</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f2f5;
    }
    h1 {
      text-align: center;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px #ccc;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    button {
      margin-top: 10px;
      padding: 6px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px #ccc;
      font-size: 13px;
      margin-bottom: 30px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <h1>üìÜ Monthly Room Rental Register</h1>

  <form id="tenantForm">
    <label>Tenant Name</label>
    <input type="text" id="name" required />

    <label>Room Number</label>
    <input type="text" id="room" required />

    <label>Monthly Rent (‚Çπ)</label>
    <input type="number" id="rent" required />

    <label>Electricity Rate (‚Çπ/unit)</label>
    <input type="number" id="rate" required value="10" />

    <label>Check-in Date</label>
    <input type="date" id="checkin" required />

    <button type="submit">Add Tenant</button>
  </form>

  <div id="tenantList"></div>

  <script>
  const form = document.getElementById("tenantForm");
  const tenantList = document.getElementById("tenantList");
  let tenants = JSON.parse(localStorage.getItem("monthlyTenants") || "[]");

  function saveData() {
    localStorage.setItem("monthlyTenants", JSON.stringify(tenants));
  }

  function monthDiff(startDate, endDate) {
    return (
      endDate.getFullYear() * 12 + endDate.getMonth() -
      (startDate.getFullYear() * 12 + startDate.getMonth()) + 1
    );
  }

  function formatMonth(year, month) {
    return `${year}-${String(month + 1).padStart(2, "0")}`;
  }

  function ensureAllMonths() {
    const today = new Date();
    const currentKey = formatMonth(today.getFullYear(), today.getMonth());

    tenants.forEach((tenant) => {
      if (!tenant.monthlyData) tenant.monthlyData = {};
      const checkin = new Date(tenant.checkin);
      const totalMonths = monthDiff(checkin, today);

      for (let i = 0; i < totalMonths; i++) {
        const m = new Date(checkin);
        m.setMonth(checkin.getMonth() + i);
        const monthKey = formatMonth(m.getFullYear(), m.getMonth());

        if (!tenant.monthlyData[monthKey]) {
          tenant.monthlyData[monthKey] = {
            rentPaid: false,
            elecStart: "",
            elecEnd: "",
            elecPaid: false
          };
        }
      }
    });
    saveData();
  }

  function renderTenants() {
    tenantList.innerHTML = "";

    tenants.forEach((tenant, index) => {
      const div = document.createElement("div");
      div.style.marginBottom = "30px";

      const title = document.createElement("h3");
title.innerHTML = `üè† ${tenant.name} | Room ${tenant.room}
  <button onclick="deleteTenant(${index})" style="margin-left:20px; background:#dc3545; color:white; padding:4px 10px; border:none; border-radius:4px; font-size:12px; cursor:pointer;">Delete</button>`;
div.appendChild(title);

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>Month</th>
          <th>Rent Paid?</th>
          <th>Elec Start</th>
          <th>Elec End</th>
          <th>Units</th>
          <th>Bill</th>
          <th>Elec Paid?</th>
        </tr>`;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      const keys = Object.keys(tenant.monthlyData).sort();

      keys.forEach((monthKey) => {
        const data = tenant.monthlyData[monthKey];
        const start = parseInt(data.elecStart || 0);
        const end = parseInt(data.elecEnd || 0);
        const units = Math.max(0, end - start);
        const bill = units * tenant.rate;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${monthKey}</td>
          <td>
            <input type="checkbox" ${data.rentPaid ? "checked" : ""} 
              onchange="togglePaid(${index}, '${monthKey}', 'rentPaid', this.checked)">
            <br><small>‚Çπ${tenant.rent}</small>
          </td>
          <td><input type="number" value="${data.elecStart}" data-i="${index}" data-month="${monthKey}" data-key="elecStart" class="elecField"></td>
          <td><input type="number" value="${data.elecEnd}" data-i="${index}" data-month="${monthKey}" data-key="elecEnd" class="elecField"></td>
          <td>${units}</td>
          <td>‚Çπ${bill}</td>
          <td><input type="checkbox" ${data.elecPaid ? "checked" : ""} 
              onchange="togglePaid(${index}, '${monthKey}', 'elecPaid', this.checked)"></td>
        `;
        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      div.appendChild(table);
      tenantList.appendChild(div);
    });

    bindInstantElectricityInputs();
  }

  function bindInstantElectricityInputs() {
    document.querySelectorAll('.elecField').forEach(input => {
      input.addEventListener('input', (e) => {
        const i = parseInt(e.target.dataset.i);
        const key = e.target.dataset.key;
        const month = e.target.dataset.month;
        const value = e.target.value;

        tenants[i].monthlyData[month][key] = value;
        saveData();
        updateUnitsAndBill(i, month);
      });
    });
  }

  function updateUnitsAndBill(index, monthKey) {
    const tenant = tenants[index];
    const data = tenant.monthlyData[monthKey];
    const start = parseInt(data.elecStart || 0);
    const end = parseInt(data.elecEnd || 0);
    const units = Math.max(0, end - start);
    const bill = units * tenant.rate;

    const allRows = tenantList.querySelectorAll("div")[index].querySelectorAll("tbody tr");
    allRows.forEach(row => {
      if (row.cells[0].innerText === monthKey) {
        row.cells[4].innerText = units;
        row.cells[5].innerText = `‚Çπ${bill}`;
      }
    });
  }

  function togglePaid(index, month, key, checked) {
    tenants[index].monthlyData[month][key] = checked;
    saveData();
    renderTenants();
  }

  form.onsubmit = (e) => {
    e.preventDefault();
    const tenant = {
      name: document.getElementById("name").value,
      room: document.getElementById("room").value,
      rent: parseInt(document.getElementById("rent").value),
      rate: parseFloat(document.getElementById("rate").value),
      checkin: document.getElementById("checkin").value,
      monthlyData: {}
    };
    tenants.push(tenant);
    saveData();
    ensureAllMonths();
    renderTenants();
    form.reset();
  };

  window.onload = () => {
    ensureAllMonths();
    renderTenants();
  };

function deleteTenant(index) {
  if (confirm("Are you sure you want to delete this tenant?")) {
    tenants.splice(index, 1);
    saveData();
    renderTenants();
  }
}

</script>

</body>
</html>
